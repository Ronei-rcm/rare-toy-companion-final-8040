<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Login Direto - MuhlStore</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-form {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            background: #ff6b35;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s;
        }
        button:hover {
            background: #ff5722;
            transform: translateY(-2px);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); border: 1px solid #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.3); border: 1px solid #f44336; }
        .info { background: rgba(33, 150, 243, 0.3); border: 1px solid #2196F3; }
        .user-data {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .auto-login {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Login Direto - MuhlStore</h1>
        
        <div class="info status">
            <strong>üéØ SOLU√á√ÉO DIRETA:</strong> Este sistema vai fazer login automaticamente e mostrar todos os seus dados!
        </div>

        <div class="auto-login">
            <h3>üöÄ Login Autom√°tico</h3>
            <p>Clique no bot√£o abaixo para fazer login automaticamente e ver todos os seus pedidos e endere√ßos!</p>
            <button onclick="loginAutomatico()">üîë LOGIN AUTOM√ÅTICO</button>
        </div>

        <div class="login-form">
            <h3>üìù Ou fa√ßa login manualmente:</h3>
            <input type="email" id="email" placeholder="Email" value="cliente@exemplo.com">
            <input type="password" id="password" placeholder="Senha" value="senha123">
            <button onclick="fazerLogin()">üîë Fazer Login</button>
        </div>

        <div id="status"></div>
        
        <div class="user-data">
            <h3>üìä Dados do Usu√°rio:</h3>
            <p><strong>Status:</strong> <span id="userStatus">Verificando...</span></p>
            <p><strong>Email:</strong> <span id="userEmail">-</span></p>
            <p><strong>ID:</strong> <span id="userId">-</span></p>
            <p><strong>Pedidos:</strong> <span id="pedidosCount">-</span></p>
            <p><strong>Endere√ßos:</strong> <span id="enderecosCount">-</span></p>
            <p><strong>Total Gasto:</strong> <span id="totalGasto">-</span></p>
        </div>

        <button onclick="verificarDados()">üîÑ Verificar Dados</button>
        <button onclick="irParaMinhaConta()">üè† Ir para Minha Conta</button>
        <button onclick="testarPedidos()">üì¶ Testar Pedidos</button>
    </div>

    <script>
        // Login autom√°tico
        async function loginAutomatico() {
            const status = document.getElementById('status');
            status.innerHTML = '<div class="info status">üöÄ Fazendo login autom√°tico...</div>';

            try {
                // Limpar tudo primeiro
                localStorage.clear();
                sessionStorage.clear();
                
                // Fazer login
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'cliente@exemplo.com',
                        senha: 'senha123'
                    })
                });
                
                if (loginResponse.ok) {
                    status.innerHTML = '<div class="success status">‚úÖ Login autom√°tico realizado!</div>';
                    
                    // Aguardar e verificar dados
                    setTimeout(async () => {
                        await verificarDados();
                        
                        // Aguardar mais um pouco e ir para Minha Conta
                        setTimeout(() => {
                            window.location.href = '/minha-conta?t=' + Date.now();
                        }, 2000);
                    }, 1000);
                } else {
                    status.innerHTML = '<div class="error status">‚ùå Erro no login autom√°tico</div>';
                }
            } catch (error) {
                status.innerHTML = '<div class="error status">‚ùå Erro: ' + error.message + '</div>';
            }
        }

        // Verificar dados do usu√°rio
        async function verificarDados() {
            const status = document.getElementById('status');
            
            try {
                // Verificar se est√° logado
                const meResponse = await fetch('/api/auth/me', {
                    credentials: 'include'
                });
                
                if (meResponse.ok) {
                    const meData = await meResponse.json();
                    
                    if (meData.authenticated) {
                        document.getElementById('userStatus').textContent = '‚úÖ Logado';
                        document.getElementById('userEmail').textContent = meData.user.email;
                        document.getElementById('userId').textContent = meData.user.id;
                        
                        // Carregar estat√≠sticas
                        const statsResponse = await fetch('/api/customers/current/stats', {
                            credentials: 'include'
                        });
                        
                        if (statsResponse.ok) {
                            const statsData = await statsResponse.json();
                            document.getElementById('pedidosCount').textContent = statsData.totalPedidos;
                            document.getElementById('enderecosCount').textContent = statsData.enderecos;
                            document.getElementById('totalGasto').textContent = `R$ ${statsData.totalGasto.toFixed(2)}`;
                            
                            status.innerHTML = '<div class="success status">‚úÖ Usu√°rio logado! Dados carregados: ' + statsData.totalPedidos + ' pedidos, ' + statsData.enderecos + ' endere√ßos, R$ ' + statsData.totalGasto.toFixed(2) + '</div>';
                        } else {
                            status.innerHTML = '<div class="error status">‚ùå Erro ao carregar estat√≠sticas</div>';
                        }
                    } else {
                        document.getElementById('userStatus').textContent = '‚ùå N√£o logado';
                        status.innerHTML = '<div class="error status">‚ùå Usu√°rio n√£o est√° logado. Fa√ßa login primeiro.</div>';
                    }
                } else {
                    status.innerHTML = '<div class="error status">‚ùå Erro ao verificar autentica√ß√£o.</div>';
                }
            } catch (error) {
                status.innerHTML = '<div class="error status">‚ùå Erro: ' + error.message + '</div>';
            }
        }

        // Fazer login manual
        async function fazerLogin() {
            const status = document.getElementById('status');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                status.innerHTML = '<div class="error status">‚ùå Preencha email e senha.</div>';
                return;
            }
            
            status.innerHTML = '<div class="info status">üîÑ Fazendo login...</div>';

            try {
                // Limpar dados anteriores
                localStorage.clear();
                sessionStorage.clear();
                
                // Fazer login
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: email,
                        senha: password
                    })
                });
                
                if (loginResponse.ok) {
                    const loginData = await loginResponse.json();
                    
                    if (loginData.success) {
                        status.innerHTML = '<div class="success status">‚úÖ Login realizado com sucesso!</div>';
                        
                        // Aguardar um pouco e verificar dados
                        setTimeout(() => {
                            verificarDados();
                        }, 1000);
                    } else {
                        status.innerHTML = '<div class="error status">‚ùå Falha no login: ' + (loginData.error || 'Erro desconhecido') + '</div>';
                    }
                } else {
                    status.innerHTML = '<div class="error status">‚ùå Erro no servidor: ' + loginResponse.status + '</div>';
                }
            } catch (error) {
                status.innerHTML = '<div class="error status">‚ùå Erro: ' + error.message + '</div>';
            }
        }

        // Testar pedidos
        async function testarPedidos() {
            const status = document.getElementById('status');
            status.innerHTML = '<div class="info status">üì¶ Testando pedidos...</div>';

            try {
                const ordersResponse = await fetch('/api/orders', {
                    credentials: 'include'
                });
                
                if (ordersResponse.ok) {
                    const ordersData = await ordersResponse.json();
                    status.innerHTML = '<div class="success status">‚úÖ Pedidos encontrados: ' + ordersData.length + ' pedidos</div>';
                } else {
                    status.innerHTML = '<div class="error status">‚ùå Erro ao carregar pedidos: ' + ordersResponse.status + '</div>';
                }
            } catch (error) {
                status.innerHTML = '<div class="error status">‚ùå Erro: ' + error.message + '</div>';
            }
        }

        // Ir para Minha Conta
        function irParaMinhaConta() {
            window.location.href = '/minha-conta?t=' + Date.now();
        }

        // Verificar dados ao carregar a p√°gina
        window.addEventListener('load', verificarDados);
    </script>
</body>
</html>
