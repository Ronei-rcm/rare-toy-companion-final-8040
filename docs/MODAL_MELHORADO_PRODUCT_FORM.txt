// Componente ProductForm melhorado - para substituir no ProductsManager.tsx

/*
MELHORIAS IMPLEMENTADAS:
1. ‚úÖ Se√ß√µes organizadas com t√≠tulos e √≠cones
2. ‚úÖ Background diferenciado para cada se√ß√£o
3. ‚úÖ Grid responsivo (1 col mobile, 2-3 cols desktop)
4. ‚úÖ Espa√ßamento consistente
5. ‚úÖ Labels claras e placeholders √∫teis
6. ‚úÖ Bot√µes com √≠cones e estados
7. ‚úÖ Modal maior (max-w-4xl) com scroll suave
8. ‚úÖ Agrupamento l√≥gico dos campos

ESTRUTURA:
- Se√ß√£o 1: Informa√ß√µes B√°sicas (nome, categoria, descri√ß√£o)
- Se√ß√£o 2: Pre√ßo e Estoque (pre√ßo, estoque, status)
- Se√ß√£o 3: Condi√ß√£o e Badges (novo sistema de badges)
- Se√ß√£o 4: Imagens (imagem principal + galeria)
- Se√ß√£o 5: Detalhes Adicionais (marca, peso, dimens√µes, etc)
- Se√ß√£o 6: Op√ß√µes Especiais (destaque, promo√ß√£o, lan√ßamento)

SUBSTITUIR EM ProductsManager.tsx:
- Linha 272: const ProductForm = ({ isEdit = false }: { isEdit?: boolean }) => (
- At√© linha 462: );

- Linha 614: className="max-w-2xl"
- Substituir por: className="max-w-4xl max-h-[90vh] overflow-hidden flex flex-col"

- Adicionar ao DialogHeader:
  className="flex-shrink-0"

- Envolver ProductForm em:
  <div className="flex-1 overflow-y-auto px-1">
    <ProductForm isEdit />
  </div>
*/

const ProductForm = ({ isEdit = false }: { isEdit?: boolean }) => (
  <div className="space-y-4 py-2">
    {/* Se√ß√£o 1: Informa√ß√µes B√°sicas */}
    <div className="bg-muted/30 rounded-lg p-4 space-y-3">
      <h3 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide flex items-center gap-2">
        <Package className="w-4 h-4" />
        Informa√ß√µes B√°sicas
      </h3>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div className="space-y-2">
          <Label htmlFor="nome">Nome do Produto *</Label>
          <Input
            id="nome"
            value={formData.nome}
            onChange={(e) => setFormData(prev => ({ ...prev, nome: e.target.value }))}
            placeholder="Ex: Boneca Barbie Dreamhouse"
            className={formErrors.nome ? 'border-red-500' : undefined}
          />
          {formErrors.nome && <p className="text-xs text-red-600">{formErrors.nome}</p>}
        </div>
        
        <div className="space-y-2">
          <Label htmlFor="categoria">Categoria *</Label>
          <Select value={formData.categoria} onValueChange={(value) => setFormData(prev => ({ ...prev, categoria: value }))}>
            <SelectTrigger>
              <SelectValue placeholder="Selecione uma categoria" />
            </SelectTrigger>
            <SelectContent>
              {categorias.map(cat => (
                <SelectItem key={cat} value={cat}>{cat}</SelectItem>
              ))}
            </SelectContent>
          </Select>
          {formErrors.categoria && <p className="text-xs text-red-600">{formErrors.categoria}</p>}
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="descricao">Descri√ß√£o</Label>
        <Textarea
          id="descricao"
          value={formData.descricao}
          onChange={(e) => setFormData(prev => ({ ...prev, descricao: e.target.value }))}
          placeholder="Descreva o produto de forma atrativa..."
          rows={3}
          className="resize-none"
        />
      </div>
    </div>

    {/* Se√ß√£o 2: Pre√ßo e Estoque */}
    <div className="bg-muted/30 rounded-lg p-4 space-y-3">
      <h3 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
        üí∞ Pre√ßo e Estoque
      </h3>
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div className="space-y-2">
          <Label htmlFor="preco">Pre√ßo (R$) *</Label>
          <Input
            id="preco"
            type="number"
            step="0.01"
            value={formData.preco}
            onChange={(e) => setFormData(prev => ({ ...prev, preco: parseFloat(e.target.value) || 0 }))}
            placeholder="0.00"
            className={formErrors.preco ? 'border-red-500' : undefined}
          />
          {formErrors.preco && <p className="text-xs text-red-600">{formErrors.preco}</p>}
        </div>
        
        <div className="space-y-2">
          <Label htmlFor="estoque">Estoque (unidades)</Label>
          <Input
            id="estoque"
            type="number"
            value={formData.estoque}
            onChange={(e) => setFormData(prev => ({ ...prev, estoque: parseInt(e.target.value) || 0 }))}
            placeholder="0"
          />
        </div>

        <div className="space-y-2">
          <Label htmlFor="status">Status</Label>
          <Select value={formData.status} onValueChange={(value) => setFormData(prev => ({ ...prev, status: value as any }))}>
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="ativo">Ativo</SelectItem>
              <SelectItem value="inativo">Inativo</SelectItem>
              <SelectItem value="esgotado">Esgotado</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>
    </div>

    {/* Se√ß√£o 3: Condi√ß√£o e Badges */}
    <div className="bg-muted/30 rounded-lg p-4 space-y-3">
      <h3 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
        üè∑Ô∏è Condi√ß√£o e Badges
      </h3>
      
      <BadgeSelector
        selectedCondicao={selectedCondicao}
        selectedBadges={selectedBadges}
        onCondicaoChange={setSelectedCondicao}
        onBadgesChange={setSelectedBadges}
      />
    </div>

    {/* Se√ß√£o 4: Imagens */}
    <div className="bg-muted/30 rounded-lg p-4 space-y-3">
      <h3 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
        üì∏ Imagens do Produto
      </h3>
      
      <EnhancedImageUpload
        label="Imagem Principal"
        value={formData.imagemUrl}
        onChange={(url) => setFormData(prev => ({ ...prev, imagemUrl: url }))}
        placeholder="Cole uma URL ou fa√ßa upload de uma imagem"
        showPreview={true}
        maxSize={10}
      />
      {formErrors.imagemUrl && <p className="text-xs text-red-600">{formErrors.imagemUrl}</p>}

      <div className="space-y-2">
        <Label>Galeria de imagens (capa + extras)</Label>
        <p className="text-xs text-muted-foreground">A primeira imagem ser√° a capa do produto</p>
        <ImageGalleryUpload
          images={galleryImages}
          onChange={(imgs) => {
            setGalleryImages(imgs);
            const sanitized = imgs.filter(i => i.url && !i.url.startsWith('blob:'));
            const main = sanitized.find(img => img.isMain)?.url || sanitized[0]?.url || formData.imagemUrl;
            setFormData(prev => ({ ...prev, imagemUrl: main || prev.imagemUrl, imagens: sanitized.map(i => i.url) }));
          }}
          maxImages={8}
          maxSizePerImage={8}
          allowMainImage
          allowReorder
        />
      </div>
    </div>

    {/* Se√ß√£o 5: Detalhes Adicionais */}
    <div className="bg-muted/30 rounded-lg p-4 space-y-3">
      <h3 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
        ‚ÑπÔ∏è Detalhes Adicionais
      </h3>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div className="space-y-2">
          <Label htmlFor="marca">Marca</Label>
          <Input
            id="marca"
            value={formData.marca}
            onChange={(e) => setFormData(prev => ({ ...prev, marca: e.target.value }))}
            placeholder="Ex: Mattel"
          />
        </div>
        
        <div className="space-y-2">
          <Label htmlFor="material">Material</Label>
          <Input
            id="material"
            value={formData.material}
            onChange={(e) => setFormData(prev => ({ ...prev, material: e.target.value }))}
            placeholder="Ex: Pl√°stico"
          />
        </div>
      </div>
    </div>

    {/* Se√ß√£o 6: Op√ß√µes Especiais */}
    <div className="bg-muted/30 rounded-lg p-4 space-y-3">
      <h3 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
        ‚≠ê Op√ß√µes Especiais
      </h3>
      
      <div className="flex flex-wrap gap-4">
        <div className="flex items-center space-x-2">
          <Switch
            id="destaque"
            checked={formData.destaque}
            onCheckedChange={(checked) => setFormData(prev => ({ ...prev, destaque: checked }))}
          />
          <Label htmlFor="destaque" className="cursor-pointer">Produto em Destaque</Label>
        </div>
        <div className="flex items-center space-x-2">
          <Switch
            id="promocao"
            checked={formData.promocao}
            onCheckedChange={(checked) => setFormData(prev => ({ ...prev, promocao: checked }))}
          />
          <Label htmlFor="promocao" className="cursor-pointer">Em Promo√ß√£o</Label>
        </div>
        <div className="flex items-center space-x-2">
          <Switch
            id="lancamento"
            checked={formData.lancamento}
            onCheckedChange={(checked) => setFormData(prev => ({ ...prev, lancamento: checked }))}
          />
          <Label htmlFor="lancamento" className="cursor-pointer">Lan√ßamento</Label>
        </div>
      </div>
    </div>

    {/* Bot√µes de A√ß√£o */}
    <div className="flex justify-end space-x-2 pt-4 border-t">
      <Button
        variant="outline"
        onClick={() => {
          if (isEdit) {
            setIsEditDialogOpen(false);
            setEditingProduct(null);
          } else {
            setIsCreateDialogOpen(false);
          }
          resetForm();
        }}
        disabled={submitting}
      >
        Cancelar
      </Button>
      <Button
        onClick={isEdit ? handleUpdateProduct : handleCreateProduct}
        disabled={submitting || !formData.nome || !formData.categoria || !!Object.keys(formErrors).length}
      >
        {submitting ? (
          <>
            <Package className="h-4 w-4 mr-2 animate-spin" />
            {isEdit ? 'Atualizando...' : 'Criando...'}
          </>
        ) : (
          <>
            {isEdit ? <Edit className="h-4 w-4 mr-2" /> : <Plus className="h-4 w-4 mr-2" />}
            {isEdit ? 'Atualizar' : 'Criar'} Produto
          </>
        )}
      </Button>
    </div>
  </div>
);
